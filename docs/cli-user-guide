
# GuideLLM CLI User Guide 

For more details on setup and installation, see the Setup and [Installation](https://apps.neuralmagic.com/GuideLLM/README.MD/#Installation) sections. 

## About GuideLLM

The GuideLLM CLI is a performance benchmarking tool to enable you to evaluate and visualize your LLM inference serving performance before your deploy to production. GuideLLM runs via the CLI and takes in a wide array of input arguments to enable you to configure your workload to run benchmarks to the specifications that you desire. This ultimately provides the ability to understand bottlenecks in your inference serving pipeline and make changes before your users are effected by your LLM application. 

## GuideLLM CLI Quickstart 

To get started with GuideLLM, you will need to have an inference server installed and available within the same cluster as GuideLLM. GuideLLM will take a target to an inference server as a mandatory argument, so it is important to have both libraries installed on the same GPU/TPU cluster. 

To get started with GuideLLM: 
1. Deploy your model on the inference server of your choice. We recommend [vLLM](https://github.com/vllm-project/vllm). The inference server you choose should be `open-ai server` compatible for the best results. 
2. Pip install GuideLLm with: `pip install guidellm`. 
3. Once installed, cd into the GuideLLm directory with: `cd guidellm`. 
4. In order to avoid compatibility issues with GuideLLm, it is recommended to run it in a fresh [virtual environment](https://docs.python.org/3/library/venv.html).
5. Create a virtual environment with: `virtualenv -p python3.8 venv`. 
6. Now activate the venv with: source `venv/bin/activate`.
7. To run a benchmark on Neural Magic's W4A16 quantized Llama 3.1 8B , you can run the following command: ``python src/guidellm/main.py --target "http://HOST_URL/v1" --model "neuralmagic/Meta-Llama-3.1-8B-Instruct-quantized.w4a16" --data-type emulated --data "prompt_tokens=512,generated_tokens=128" --max-seconds 60``
	- This benchmark will run with default values, unless otherwise specified. 
	

## GuideLLM CLI Details
### Input Metrics
The input arguments are split up into 3 sections: 

- **Workload Overview**
- **Workload Data**
- **Workload Type**

Once you fill out these arguments and run the command, GuideLLM will run the simulated workload. Note the time it takes to run can be set with <em>max_seconds</em>, but may also depend on the hardware and model. 

### Workload Overview

This section of input parameters covers what to actually benchmark including the target host location, model, and task. The full list of arguments and their defintions are presented below:

-   **--target** <em>(str, default: localhost with chat completions api for VLLM)</em>: Target for benchmarking 
    
	-   optional breakdown args if target isn't specified:
    
		-   **--host** <em>(str)</em>: Host URL for benchmarking
    
		-   **--port** <em>(str)</em>: Port available for benchmarking
    
-   **--backend** <em>(str, default: server_openai [vllm, TGI, llama.cpp, DeepSparse, and many popular servers match this format])</em>: Backend type for benchmarking
    
-   **--model** <em>(str, default: auto populated from vllm server)</em>: Model being used for benchmarking, running on the inference server
        
-   **--task** <em>(str), optional)</em>: Task to use for benchmarking

-  **--output-path** <em>(str), optional)</em>: Path to save report report to



### Workload Data

This section of input parameters covers the data arguments that need to be supplied such as a reference to the dataset and tokenizer. The list of arguments and their defintions are presented below:

-   **--data** <em>(str)</em>: Data file or alias for benchmarking

-   **--data-type** <em>(ENUM, default: emulated; [file, transformers])</em>: The type of data given for benchmarking

-   **--tokenizer** <em>(str)</em>: Tokenizer to use for benchmarking

### Workload Type

This section of input parameters covers the type of workload that you want to run to represent the type of load you expect on your server in production such as rate-per-second and the frequency of requests. The full list of arguments and their definitions are presented below:

-   **--rate-type**  <em>(ENUM, default: sweep; [serial, constant, poisson] where sweep will cover a range of constant request rates and ensure saturation of server, serial will send one request at a time, constant will send a constant request rate, poisson will send a request rate sampled from a poisson distribution at a given mean) </em>: Type of rate generation for benchmarking
    
-   **--rate** <em>(float)</em>: Rate to use for constant and poisson rate types
    
-   **--max-seconds** <em>(integer)</em>: Number of seconds to result each request rate at
    
-   **--max-requests** <em>(integer)</em>: Number of requests to send for each rate
    
### Output Metrics via GuideLLM Benchmarks Report

Once your GuideLLM run is complete, the output metrics are displayed as a GuideLLM Benchmarks Report via the Terminal in the following 4 sections: 

- **Requests Data by Benchmark**
- **Tokens Data by Benchmark**
- **Performance Stats by Benchmark**
- **Performance Summary by Benchmark**

The GuideLLM Benchmarks Report surfaces key LLM metrics to help you determine the health and performance of your inference server. You can use the numbers generated by the GuideLLM Benchmarks Report to make decisions around server request processing, Service Level Objective (SLO) success/failure for your task, general model performance, and hardware impact.

### Requests Data by Benchmark 

This section shows the request statistics for the benchmarks that were run. Request Data statistics highlight the details of the requests hitting the inference server. Viewing this information is essential to understand the health of your server processing requests sent by GuideLLM and can surface potential issues in your inference serving pipeline including software and hardware issues. 

This table includes:
- **Benchmark:** Synchronous or Asynchronous@X req/sec
- **Requests Completed:** the number of successful requests handled 
- **Requests Failed:** the number of failed requests
- **Duration (sec):** the time taken to run the specific benchmark, determined by <em>max_seconds</em> 
- **Start Time (HH:MI:SS):** local timestamp the GuideLLM benchmark started 
- **End Time (HH:MI:SS):** local timestamp the GuideLLM benchmark ended 


### Tokens Data by Benchmark
This section shows the prompt and output token distribution statistics for the benchmarks that were run. Token Data statistics highlight the details of your dataset in terms of prompts and generated outputs from the model. Viewing this information is integral to understanding model performance on your task and to ensure you are able to hit SLOs required to guarentee a good user experience from your application. 

This table includes:
- **Benchmark:** Synchronous or Asynchronous@X req/sec
- **Prompt (token length):** the average length of prompt tokens 
- **Prompt (1%, 5%, 50%, 95%, 99%):** Distribution of prompt token length
- **Output (token length):** the average length of output tokens
- **Output (1%, 5%, 50%, 95%, 99%):** Distribution of output token length

### Performance Stats by Benchmark
This section shows the LLM peformance statistics for the benchmarks that were run. Performance Statistics highlight the performance of the model across the key LLM performance metrics including: Request Latency, Time to First Token (TTFT), Inter Token Latench (ITL or TPOT), and Output Token Throughput. Viewing these key metrics are integral to ensuring the performance of your inference server for your task on your designated hardware where you are running your inference server. 

This table includes:
- **Benchmark:** Synchronous or Asynchronous@X req/sec
- **Request Latency [1%, 5%, 10%, 50%, 90%, 95%, 99%] (sec)**: the time it takes from submitting a query to receiving the full response, including the performance of your queueing/batching mechanisms and network latencies
-  **Time to First Token [1%, 5%, 10%, 50%, 90%, 95%, 99%] (ms)**: the time it takes from submitting the query to receiving the first token (if the response is not empty); often abbreviated as TTFT
- **Inter Token Latency [1%, 5%, 10%, 50%, 90% 95%, 99%] (ms)**: the time between consecutive tokens and is also known as time per output token (TPOT)
-  **Output Token Throughput (tokens/sec)**: the total output tokens per second throughput, accounting for all the requests happening simultaneously


### Performance Summary by Benchmark
This section shows the averages for the LLM peformance statistics for the benchmarks that were run. The average Performance Statistics provide an overall summary of the model performance across the key LLM performance metrics. Viewing these summary metrics are integral to ensuring the performance of your inference server for your task on your designated hardware where you are running your inference server. 

This table includes:
- **Benchmark:** Synchronous or Asynchronous@X req/sec
- **Request Latency (sec)**: the average time it takes from submitting a query to receiving the full response, including the performance of your queueing/batching mechanisms and network latencies
-  **Time to First Token (ms)**: the average time it takes from submitting the query to receiving the first token (if the response is not empty); often abbreviated as TTFT
- **Inter Token Latency (ms)**: the average time between consecutive tokens and is also known as time per output token (TPOT)
-  **Output Token Throughput (tokens/sec)**: the total average output tokens per second throughput, accounting for all the requests happening simultaneously


## Report a Bug

To report a bug, file an issue on [GitHub Issues](https://github.com/neuralmagic/guidellm/issues). 



